var q=Object.defineProperty;var U=(t,e,o)=>e in t?q(t,e,{enumerable:!0,configurable:!0,writable:!0,value:o}):t[e]=o;var B=(t,e,o)=>(U(t,typeof e!="symbol"?e+"":e,o),o);(function(){const e=document.createElement("link").relList;if(e&&e.supports&&e.supports("modulepreload"))return;for(const i of document.querySelectorAll('link[rel="modulepreload"]'))n(i);new MutationObserver(i=>{for(const s of i)if(s.type==="childList")for(const c of s.addedNodes)c.tagName==="LINK"&&c.rel==="modulepreload"&&n(c)}).observe(document,{childList:!0,subtree:!0});function o(i){const s={};return i.integrity&&(s.integrity=i.integrity),i.referrerPolicy&&(s.referrerPolicy=i.referrerPolicy),i.crossOrigin==="use-credentials"?s.credentials="include":i.crossOrigin==="anonymous"?s.credentials="omit":s.credentials="same-origin",s}function n(i){if(i.ep)return;i.ep=!0;const s=o(i);fetch(i.href,s)}})();class H{constructor(){B(this,"events",new Map)}addEventListener(e,o){let n=this.events.get(e);n?n.push(o):this.events.set(e,[o])}removeAllEventListener(e){this.events.has(e)&&this.events.delete(e)}removeEventListener(e,o){let n=this.events.get(e);if(!n||n.length===0)return;let i=n.findIndex(s=>s===o);i!==-1&&n.splice(i,1)}once(e,o){let n=(...i)=>{o(...i),this.removeEventListener(e,n)};this.addEventListener(e,n)}emit(e,...o){let n=this.events.get(e);!n||n.length===0||n.forEach(i=>{i(...o)})}listenerCount(e){let o=this.events.get(e);return o?o.length:0}rawListeners(e){return this.events.get(e)||null}}const E=t=>`/snake-game/${t}`,m=document.createElement("canvas"),f=m.getContext("2d"),r=35,O=r*2,u=Math.floor((innerWidth-O)/r),p=Math.floor((innerHeight-O)/r);let L=Math.floor(u/2),b=Math.floor(p/2);const k="#8ECC39",C="#A8D948",$=["apple","bodyVertical","bodyHorizontal","bodyBottomLeft","bodyBottomRight","bodyTopLeft","bodyTopRight","headDown","headLeft","headUp","headRight","tailDown","tailLeft","tailUp","tailRight"],l={},h=new H,z=new Audio(E("crunch.wav")),N=new Audio(E("gameOver.mp3")),y="right";let d=y,w=null,g={},j=100,K=0,M=[{x:L,y:b,direction:y},{x:L-1,y:b,direction:y},{x:L-2,y:b,direction:y}],a=[...M];const V=(t,e)=>new Promise((o,n)=>{e.src=E(`${t}.png`),e.onload=o,e.onerror=n}),F=()=>Promise.all($.map(t=>(l[t]=new Image,V(t,l[t])))),W=()=>{let{x:t,y:e}=a[0];g.x===t&&g.y===e?(z.play(),h.emit("score-change",++K),g=x()):a.pop(),d==="right"?t++:d==="left"?t--:d==="top"?e--:d==="bottom"&&e++,t>=u?t=0:t<0?t=u-1:e<0?e=p-1:e>=p&&(e=0),a[0].direction=d,a.unshift({x:t,y:e,direction:d})},X=()=>{if(J())return Y();W(),D(),S(),R(),I()},Y=()=>{w&&(N.play(),clearInterval(w),w=null,h.emit("game-over"))},J=()=>{let{x:t,y:e}=a[0];return a.some((o,n)=>n===0?!1:o.x===t&&o.y===e)},D=()=>{f.clearRect(0,0,m.width,m.height)},S=()=>{f.save();for(let t=0;t<u;t++){let e=t%2===0?k:C;for(let o=0;o<p;o++)f.fillStyle=e,f.fillRect(t*r,o*r,r,r),f.fill(),e=e===k?C:k}f.restore()},x=()=>{let t=Math.floor(Math.random()*u),e=Math.floor(Math.random()*p);return a.some(n=>n.x===t&&n.y===e)?x():{x:t,y:e}},R=()=>{f.drawImage(l.apple,g.x*r,g.y*r,r,r)},I=()=>{for(let t=a.length-1;t>=0;t--)t===0?Q():t===a.length-1?Z():_(t)},Q=()=>{let t,{x:e,y:o,direction:n}=a[0];n==="top"?t=l.headUp:n==="bottom"?t=l.headDown:n==="right"?t=l.headRight:n==="left"&&(t=l.headLeft),t&&f.drawImage(t,e*r,o*r,r,r)},Z=()=>{let t,{x:e,y:o,direction:n}=a[a.length-1];n==="top"?t=l.tailDown:n==="bottom"?t=l.tailUp:n==="right"?t=l.tailLeft:n==="left"&&(t=l.tailRight),t&&f.drawImage(t,e*r,o*r,r,r)},_=t=>{let e,{x:o,y:n,direction:i}=a[t],s=a[t-1],c=a[t+1];c.x===o&&s.x===o?e=l.bodyVertical:c.y===n&&s.y===n?e=l.bodyHorizontal:c.direction==="right"&&i==="top"||c.direction==="bottom"&&i==="left"?e=l.bodyTopLeft:c.direction==="left"&&i==="bottom"||c.direction==="top"&&i==="right"?e=l.bodyBottomRight:c.direction==="bottom"&&i==="right"||c.direction==="left"&&i==="top"?e=l.bodyTopRight:(c.direction==="right"&&i==="bottom"||c.direction==="top"&&i==="left")&&(e=l.bodyBottomLeft),e&&f.drawImage(e,o*r,n*r,r,r)},G=()=>{w=setInterval(X,j)},ee=t=>{let e=a[0].direction,o=e==="left",n=e==="right",i=e==="top",s=e==="bottom";t.key==="ArrowLeft"&&!n?d="left":t.key==="ArrowRight"&&!o?d="right":t.key==="ArrowUp"&&!s?d="top":t.key==="ArrowDown"&&!i&&(d="bottom")},te=()=>{a=[...M],d=y,D(),S(),I(),R(),G()},oe=async t=>{let e=document.querySelector(t);e&&(window.addEventListener("keydown",ee),await F(),m.width=u*r,m.height=p*r,g=x(),e.append(m),S(),I(),R())},v={init:oe,start:G,restart:te,addEventListener:h.addEventListener.bind(h),removeEventListener:h.removeEventListener.bind(h)};const P=document.querySelector(".play-btn"),T=document.querySelector(".score-board").lastElementChild,A=document.querySelector(".game-over"),ne=A.lastElementChild,ie=()=>{P.classList.add("hide"),v.start()},re=()=>{A.classList.add("hide"),T.textContent="0",v.restart()},se=t=>{T.textContent=t.toString()},le=()=>{A.classList.remove("hide")};P.addEventListener("click",ie);ne.addEventListener("click",re);v.addEventListener("score-change",se);v.addEventListener("game-over",le);v.init("#app");
